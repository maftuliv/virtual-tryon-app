<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест Валидации</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f0f0;
        }

        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .status.ok {
            background: #d1fae5;
            color: #065f46;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }

        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #2563eb;
        }

        .preview-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .preview-item {
            position: relative;
            width: 200px;
            height: 200px;
            border: 2px solid #ccc;
            border-radius: 10px;
            overflow: hidden;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-status-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .preview-status-badge.status-ok {
            color: #10b981;
            border: 1px solid #10b981;
        }

        .preview-status-badge.status-warning {
            color: #f59e0b;
            border: 1px solid #f59e0b;
        }

        .preview-item.validated-ok {
            border-color: #10b981;
        }

        .preview-item.has-warnings {
            border-color: #f59e0b;
        }
    </style>
</head>
<body>
    <h1>Тестирование Функций Валидации</h1>

    <div class="test-section">
        <h2>Тест 1: Функция validatePreviewImage</h2>
        <div id="test1-status" class="status">Ожидание...</div>
        <button onclick="runTest1()">Запустить Тест 1</button>
        <div id="test1-preview" class="preview-container"></div>
    </div>

    <div class="test-section">
        <h2>Тест 2: Modal Window (showExamplesModal)</h2>
        <div id="test2-status" class="status">Ожидание...</div>
        <button onclick="showExamplesModal('person')">Открыть Примеры Человека</button>
        <button onclick="showExamplesModal('garment')">Открыть Примеры Одежды</button>
    </div>

    <div class="test-section">
        <h2>Тест 3: Category Selector</h2>
        <div id="test3-status" class="status">Ожидание...</div>
        <div class="category-selector">
            <label>Тип одежды:</label><br>
            <label><input type="radio" name="garmentCategory" value="auto" checked> Авто</label>
            <label><input type="radio" name="garmentCategory" value="tops"> Верх</label>
            <label><input type="radio" name="garmentCategory" value="bottoms"> Низ</label>
            <label><input type="radio" name="garmentCategory" value="one-pieces"> Платья</label>
        </div>
        <div id="test3-result"></div>
    </div>

    <div class="test-section">
        <h2>Результаты Проверки</h2>
        <div id="overall-results"></div>
    </div>

    <!-- Modal -->
    <div id="examplesModal" class="modal" style="display: none;">
        <div class="modal-content" style="background: white; margin: 100px auto; padding: 20px; width: 80%; max-width: 600px; border-radius: 20px; position: relative;">
            <span class="modal-close" onclick="closeExamplesModal()" style="position: absolute; top: 10px; right: 20px; font-size: 30px; cursor: pointer;">&times;</span>
            <h2 id="modalTitle" class="modal-title">Примеры фотографий</h2>
            <div id="modalBody" class="modal-body"></div>
        </div>
    </div>

    <script>
        let testResults = {
            validateFunction: false,
            modalFunction: false,
            categorySelector: false
        };

        // Test 1: validatePreviewImage
        async function runTest1() {
            const statusDiv = document.getElementById('test1-status');
            const previewDiv = document.getElementById('test1-preview');

            statusDiv.textContent = 'Выполняется...';
            statusDiv.className = 'status';

            try {
                // Create test image (1x1 pixel data URL)
                const testImageSrc = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';

                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';

                const img = document.createElement('img');
                img.src = testImageSrc;
                previewItem.appendChild(img);
                previewDiv.appendChild(previewItem);

                // Wait for image to load
                await new Promise((resolve) => {
                    img.onload = resolve;
                });

                // Call validation function
                await validatePreviewImage(previewItem, testImageSrc, 'person', 0);

                // Check if badge was added
                const badge = previewItem.querySelector('.preview-status-badge');

                if (badge) {
                    statusDiv.className = 'status ok';
                    statusDiv.textContent = '✅ Тест пройден! Функция validatePreviewImage работает корректно. Бейдж добавлен.';
                    testResults.validateFunction = true;
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '❌ Тест не пройден! Бейдж не был добавлен.';
                    testResults.validateFunction = false;
                }

                updateOverallResults();
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '❌ Ошибка: ' + error.message;
                testResults.validateFunction = false;
                updateOverallResults();
            }
        }

        // Validate preview image function (copy from app.js)
        async function validatePreviewImage(previewDiv, imageSrc, type, index) {
            try {
                const tempImg = new Image();
                tempImg.src = imageSrc;

                await new Promise((resolve) => {
                    tempImg.onload = resolve;
                });

                const width = tempImg.width;
                const height = tempImg.height;

                const warnings = [];

                if (width < 512 || height < 512) {
                    warnings.push('Низкое разрешение');
                }

                if (height > 2000 || width > 2000) {
                    warnings.push('Будет уменьшено');
                }

                const badge = document.createElement('div');
                badge.className = 'preview-status-badge';

                if (warnings.length === 0) {
                    badge.classList.add('status-ok');
                    badge.innerHTML = '<span class="status-icon">✅</span><span>OK</span>';
                    previewDiv.classList.add('validated-ok');
                } else {
                    badge.classList.add('status-warning');
                    badge.innerHTML = '<span class="status-icon">⚠️</span><span>' + warnings[0] + '</span>';
                    previewDiv.classList.add('has-warnings');
                    badge.title = warnings.join(', ');
                }

                previewDiv.appendChild(badge);

            } catch (error) {
                console.error('[VALIDATION] Error validating preview:', error);
                throw error;
            }
        }

        // Test 2: Modal functions (copy from app.js)
        function showExamplesModal(type) {
            const statusDiv = document.getElementById('test2-status');

            try {
                const modal = document.getElementById('examplesModal');
                const title = document.getElementById('modalTitle');
                const body = document.getElementById('modalBody');

                if (type === 'person') {
                    title.textContent = 'Примеры фото человека';
                    body.innerHTML = `
                        <div style="padding: 20px;">
                            <h3>✅ Хорошее фото</h3>
                            <p>• Человек в полный рост<br>• Четкое изображение<br>• Хорошее освещение</p>
                            <h3>❌ Плохое фото</h3>
                            <p>• Обрезанное тело<br>• Размытое изображение</p>
                        </div>
                    `;
                } else {
                    title.textContent = 'Примеры фото одежды';
                    body.innerHTML = `
                        <div style="padding: 20px;">
                            <h3>✅ Хорошее фото</h3>
                            <p>• Flat-lay (одежда разложена)<br>• Четкое изображение</p>
                            <h3>❌ Плохое фото</h3>
                            <p>• Сложный фон<br>• Размытое фото</p>
                        </div>
                    `;
                }

                modal.style.display = 'block';

                statusDiv.className = 'status ok';
                statusDiv.textContent = '✅ Тест пройден! Модальное окно открывается корректно.';
                testResults.modalFunction = true;
                updateOverallResults();
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = '❌ Ошибка: ' + error.message;
                testResults.modalFunction = false;
                updateOverallResults();
            }
        }

        function closeExamplesModal() {
            const modal = document.getElementById('examplesModal');
            modal.style.display = 'none';
        }

        // Test 3: Category selector
        document.querySelectorAll('input[name="garmentCategory"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const statusDiv = document.getElementById('test3-status');
                const resultDiv = document.getElementById('test3-result');

                statusDiv.className = 'status ok';
                statusDiv.textContent = '✅ Тест пройден! Category selector работает корректно.';
                resultDiv.textContent = `Выбрано: ${e.target.value}`;

                testResults.categorySelector = true;
                updateOverallResults();
            });
        });

        function updateOverallResults() {
            const overallDiv = document.getElementById('overall-results');

            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(v => v === true).length;

            overallDiv.innerHTML = `
                <h3>Общие результаты: ${passed}/${total} тестов пройдено</h3>
                <ul>
                    <li>${testResults.validateFunction ? '✅' : '⏳'} Функция validatePreviewImage</li>
                    <li>${testResults.modalFunction ? '✅' : '⏳'} Модальное окно showExamplesModal</li>
                    <li>${testResults.categorySelector ? '✅' : '⏳'} Category Selector</li>
                </ul>
            `;
        }

        // Initialize results
        updateOverallResults();
    </script>
</body>
</html>
